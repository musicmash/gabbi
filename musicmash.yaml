defaults:
    ssl: True
    request_headers:
      x-auth-token: 561d2f2f-3226-11e9-94f1-0242ac110005

tests:
  - name: must redirect to ssl
    ssl: False
    GET: /api/feed
    status: 301
    response_headers:
      location: /^https/

  - name: get user feed without ssl
    ssl: False
    redirects: True
    GET: /api/feed
    response_headers:
        content-type: application/json

  - name: get unknown user feed without ssl
    ssl: False
    redirects: True
    GET: /api/feed
    request_headers:
      content-type: application/json
      x-auth-token: unknown-token
    status: 401

  - name: get user feed
    GET: /api/feed
    response_headers:
        content-type: application/json

  - name: get unknown user feed
    GET: /api/feed
    request_headers:
      content-type: application/json
      x-auth-token: unknown-token
    status: 401

  - name: get user feed since first day of 2019 year
    GET: /api/feed
    query_parameters:
      since:
          - "2019-01-01"
    response_headers:
        content-type: application/json
    response_json_paths:
      $.date: "2019-01-01T00:00:00Z"

  - name: get unknown user feed since first day of 2019 year
    GET: /api/feed
    request_headers:
      content-type: application/json
      x-auth-token: unknown-token
    query_parameters:
      since:
          - "2019-01-01"
    status: 401

  - name: unsubscribe user from an artist
    DELETE: /api/subscriptions
    request_headers:
        content-type: application/json
    data:
      - "skrillex"

  - name: unsubscribe unknown user from an artist
    DELETE: /api/subscriptions
    request_headers:
      content-type: application/json
      x-auth-token: unknown-token
    data:
      - "skrillex"
    status: 401

  - name: subscribe user for an artist
    skip: currently API freezes after 5 subscribe requests
    POST: /api/subscriptions
    request_headers:
        content-type: application/json
    data:
      - "skrillex"
    status: 202

  - name: subscribe unknown user for an artist
    POST: /api/subscriptions
    request_headers:
        content-type: application/json
        x-auth-token: unknown-token
    data:
      - "skrillex"
    status: 401

  - name: search an artist
    GET: /api/artists
    query_parameters:
      name:
          - "slipknot"
    response_headers:
        content-type: application/json

  - name: search an artist from unknown user
    GET: /api/artists
    query_parameters:
      name:
          - "slipknot"
    request_headers:
      x-auth-token: unknown-token
    status: 401

  - name: show artist details
    GET: /api/artists/rammstein
    response_headers:
        content-type: application/json

  - name: show artist details from unknown user
    GET: /api/artists/rammstein
    request_headers:
      x-auth-token: unknown-token
    status: 401
